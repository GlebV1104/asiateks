{% extends "base.html" %}
{% block title %}ASIATEKS - Каталог{% endblock %}

{% block body %}
<section class="product-catalog" aria-labelledby="catalog-heading">
  <div class="product-catalog-container">
    <h1 id="catalog-heading" class="catalog-heading">Наша продукция</h1>

    <!-- Filter -->
    <form method="get" action="{{ url_for('products') }}" class="catalog-filter" role="search" aria-label="Фильтр каталога">
      <label class="sr-only" for="catalog-search">Поиск</label>
      <input id="catalog-search" type="text" name="search" placeholder="Поиск..." value="{{ query or '' }}" autocomplete="off" />

      <label class="sr-only" for="catalog-tag">Тег</label>
      <select id="catalog-tag" name="tag" onchange="this.form.submit()">
        <option value="">Все теги</option>
        <option value="страйп" {% if tag_filter == 'страйп' %}selected{% endif %}>Страйп</option>
        <option value="перкаль" {% if tag_filter == 'перкаль' %}selected{% endif %}>Перкаль</option>
        <option value="пестроткань" {% if tag_filter == 'пестроткань' %}selected{% endif %}>Пестроткань</option>
        <option value="классический" {% if tag_filter == 'классический' %}selected{% endif %}>Классический</option>
        <option value="гладкокрашенный" {% if tag_filter == 'гладкокрашенный' %}selected{% endif %}>Гладкокрашенный</option>
        <option value="рогожка" {% if tag_filter == 'рогожка' %}selected{% endif %}>Рогожка</option>
        <option value="полувар" {% if tag_filter == 'полувар' %}selected{% endif %}>Полувар</option>
        <option value="классика" {% if tag_filter == 'классика' %}selected{% endif %}>Классика</option>
        <option value="набивная" {% if tag_filter == 'набивная' %}selected{% endif %}>Набивная</option>
      </select>


      <button type="submit" class="catalog-search-btn" aria-label="Применить фильтр">
        <img src="{{ url_for('static', filename='assets/search.png') }}" alt="" aria-hidden="true" />
      </button>
    </form>

    <!-- Grid -->
    {% if products and products|length %}
      <div class="catalog-grid" role="list">
        {% for product in products %}
          <article class="catalog-card" role="listitem">
            <a class="catalog-media" href="{{ url_for('product_detail', product_id=product.id) }}">
              <img
                src="{{ url_for('static', filename=(product.images[0] if product.images else 'assets/placeholder.jpg')) }}"
                alt="{{ product.title or product.name }}"
                class="catalog-image"
                loading="lazy" />
            </a>

            <!-- Title (name shown; falls back to `name` if `title` is missing) -->
            <h2 class="catalog-title">
              <a href="{{ url_for('product_detail', product_id=product.id) }}">
                {{ product.title or product.name }}
              </a>
            </h2>

            <!-- Price -->
            <p class="catalog-price">
              {% if product.price %}
                От {{ product.price|min }}&nbsp;₽
              {% else %}
                Цена по запросу
              {% endif %}
            </p>

            <a href="{{ url_for('product_detail', product_id=product.id) }}" class="catalog-link">Подробнее</a>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="catalog-empty">
        <p>Ничего не найдено по заданным критериям.</p>
        <a class="catalog-reset" href="{{ url_for('products') }}">Сбросить фильтры</a>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
